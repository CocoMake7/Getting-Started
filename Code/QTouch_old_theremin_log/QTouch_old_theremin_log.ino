#include "QTouchADCTiny.h"

int refPin  = PB2;
int sensePin =  PB4;
int speakerPin = PB0;

int ref1 = 0;
int value1 = 0;

#include <avr/pgmspace.h>
PROGMEM const unsigned char lut[256] = 
{
0,
0,
0,
0,
0,
0,
0,
0,
  255,

  251,

  247,

  244,

  240,

  236,

  233,

  230,

  227,

  223,

  220,

  217,

  215,

  212,

  209,

  206,

  204,

  201,

  199,

  196,

  194,

  192,

  190,

  187,

  185,

  183,

  181,

  179,

  177,

  175,

  173,

  171,

  170,

  168,

  166,

  164,

  163,

  161,

  160,

  158,

  157,

  155,

  154,

  152,

  151,

  149,

  148,

  147,

  145,

  144,

  143,

  141,

  140,

  139,

  138,

  137,

  136,

  134,

  133,

  132,

  131,

  130,

  129,

  128,

  127,

  126,

  125,

  124,

  123,

  122,

  121,

  120,

  119,

  119,

  118,

  117,

  116,

  115,

  114,

  114,

  113,

  112,

  111,

  110,

  110,

  109,

  108,

  108,

  107,

  106,

  105,

  105,

  104,

  103,

  103,

  102,

  101,

  101,

  100,

  100,

  99,

  98,

  98,

  97,

  97,

  96,

  95,

  95,

  94,

  94,

  93,

  93,

  92,

  92,

  91,

  91,

  90,

  90,

  89,

  89,

  88,

  88,

  87,

  87,

  86,

  86,

  85,

  85,

  84,

  84,

  83,

  83,

  83,

  82,

  82,

  81,

  81,

  81,

  80,

  80,

  79,

  79,

  79,

  78,

  78,

  77,

  77,

  77,

  76,

  76,

  76,

  75,

  75,

  75,

  74,

  74,

  73,

  73,

  73,

  72,

  72,

  72,

  71,

  71,

  71,

  71,

  70,

  70,

  70,

  69,

  69,

  69,

  68,

  68,

  68,

  68,

  67,

  67,

  67,

  66,

  66,

  66,

  66,

  65,

  65,

  65,

  65,

  64,

  64,

  64,

  64,

  63,

  63,

  63,

  63,

  62,

  62,

  62,

  62,

  61,

  61,

  61,

  61,

  60,

  60,

  60,

  60,

  59,

  59,

  59,

  59,

  59,

  58,

  58,

  58,

  58,

  58,

  57,

  57,

  57,

  57,

  56,

  56,

  56,

  56,

  56,

  55,

  55,

  55,

  55,

  55,

  55,

  54,

  54,

  54,

  54,

  54,

  53,

  53,

  53,

  53,

  53,

  53,

  52,

  52,

  0,
};


void setup() {
  
  TCCR0B = TCCR0B & 0b1111011; //timer pre-scaler divided by 8 or some other
  TCCR0A = (TCCR0A & 0b00111100) | 0b01000010; //sets to CTC and toggle Mode
  
  QTouchADCTiny.init();
  ref1 = QTouchADCTiny.sense(sensePin, refPin, 500);
  
  pinMode(speakerPin, OUTPUT);
}

void loop() {

  value1 = (QTouchADCTiny.sense(sensePin, refPin, 100) - ref1);
  
  if(value1<=0) value1 = 0;
  if(value1>=255) value1 = 255;

  int16_t idx = (value1); // offset probe_val by value of untouched probe

  OCR0A = (pgm_read_byte(&lut[idx]));

}
